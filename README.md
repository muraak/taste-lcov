# lcovの実験

同じソースを使用する、ことなる実行ファイルのカバレッジ測定結果をマージできることをためした。方法は以下の通り。

1. `lib.h`の2つの実装`lib_actual.cpp`と`lib_stub.cpp`を用意する。

2. `test.cpp`と`lib_actual.cpp`をリンクした実行ファイル`actual`と、`test.cpp`と`lib_stub.cpp`をリンクした実行ファイル`stub`を生成し、各々でカバレッジ測定を実行する。ここで、`test.cpp`でコールする関数は、`lib_stub.cpp`バージョンの`lib.h`の実装と`lib_actual.cpp`バージョンの`lib.h`実装の関数を2つとも実行しない限り、C2カバレッジが100%になることはない。

3. 各々のカバレッジ測定結果をlcovの`-a`オプションでマージする。

4. genhtmlで生成した結果で、`test.cpp`内のカバレッジ測定結果がALL100%であることを確認する。

## 結果

異なる実行ファイルの結果でも、マージすることができた。ただし、それぞれのカバレッジ測定用の中間ファイルが残ったまま、ほかの実行ファイルのビルド・測定を行うとエラーとなる。
したがって*.infoファイルだけ生成できたら、その他の中間ファイルはすべて除去してから、次の測定を行う必要があった。

## 再現方法

1. 本ディレクトリにbuildディレクトリを作成し、移動する。
2. `sh ../build.sh`でビルド・カバレッジ測定・マージ・html生成が完了する。
3. 生成されたindex.htmlでカバレッジ測定結果がALL100%であることを確認できる。
4. buildディレクトリで`sh ../clean.sh`すると生成物を削除できる。

以上